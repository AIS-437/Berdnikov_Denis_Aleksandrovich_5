# Настройка отказоустойчивого веб-кластера на основе Nginx и резервного копирования БД

## Цель

Закрепить и расширить знания по администрированию информационных систем на практике, освоив принципы построения отказоустойчивых (High Availability, HA) инфраструктур. В рамках работы изучается проектирование и настройка веб-кластера на базе Nginx, обеспечение непрерывности работы базы данных за счет репликации, а также реализация стратегии резервного копирования для защиты от потери данных. Результаты работы оформляются в виде реферата и размещаются в среде совместной разработки.

## Задание

- Изучить теоретические основы отказоустойчивости, балансировки нагрузки (Load Balancing), репликации и резервного копирования баз данных.
- Спроектировать архитектуру отказоустойчивого кластера, включающего уровень балансировщиков Nginx и уровень реплицируемых баз данных.
- Подготовить реферат, детально описывающий архитектуру, шаги настройки ключевых компонентов (Keepalived, Nginx, СУБД), а также стратегию резервного копирования.
- Оформить реферат в соответствии с требованиями дисциплины в формате MS Word и в формате Markdown (README.md).
- Разместить оба варианта реферата в репозитории на GitHub.
- Направить работу преподавателю по электронной почте, указав прямую ссылку на репозиторий.

## Введение

В современной цифровой экономике доступность информационных систем и сохранность данных являются критически важными факторами для любого бизнеса. Простой веб-сервиса, вызванный отказом оборудования, программной ошибкой или внешней атакой, ведет к прямым финансовым потерям и ущербу репутации. Для решения этих задач проектируются отказоустойчивые кластеры, способные автоматически перераспределять нагрузку при сбоях, и системы защиты данных, гарантирующие их восстановление в любой ситуации.

Данная работа посвящена комплексному подходу к построению такой инфраструктуры. В качестве основы рассматривается использование веб-сервера и обратного прокси-сервера Nginx в связке с демоном Keepalived для создания высокодоступного кластера балансировщиков нагрузки. Этот уровень обеспечивает бесперебойный доступ пользователей к сервису даже при выходе из строя одного из серверов.

Однако отказоустойчивость веб-уровня теряет смысл, если данные на backend-серверах не согласованы или утеряны. Поэтому второй ключевой аспект работы - организация репликации базы данных (например, MySQL/MariaDB Master-Master) для обеспечения доступности и целостности данных. Третий, не менее важный компонент - стратегия резервного копирования (backup), которая, в отличие от репликации, защищает от логических ошибок, случайного удаления или атак шифровальщиков, позволяя откатить данные на определенный момент времени .

Таким образом, успешная настройка отказоустойчивого кластера требует понимания и интеграции нескольких технологий, что и является предметом изучения в данном реферате.

Архитектура отказоустойчивого кластера

**Уровень балансировки нагрузки на основе Nginx и Keepalived**

Для устранения единой точки отказа на входе в систему используется кластеризация самих балансировщиков. Базовая и наиболее распространенная схема - активно-пассивная (active-passive).

Принцип работы: На двух или более физических серверах с установленным Nginx запускается демон Keepalived. Он управляет виртуальным IP-адресом (Virtual IP, VIP), который указывает в DNS как адрес веб-сервиса. Keepalived на всех узлах обменивается служебными сообщениями по протоколу VRRP.

Механизм отказа (Failover): Узел с высшим приоритетом (priority) удерживает VIP и является активным, обрабатывая весь входящий трафик. Если этот узел выходит из строя (или Nginx на нем останавливается), Keepalived на резервном узле с более низким приоритетом детектирует потерю связи и автоматически присваивает VIP себе, становясь активным. Для пользователя переключение происходит практически мгновенно и прозрачно .

Проверка работоспособности (Health Check): Keepalived можно настроить на отслеживание не только состояния сети, но и работы службы Nginx с помощью скриптов (vrrp_script). Если Nginx аварийно завершится на активном узле, Keepalived автоматически снизит его приоритет, что спровоцирует переход VIP на резервный узел .

Для более сложных сценариев с высокой нагрузкой может применяться активно-активная (active-active) конфигурация. В этом случае используется несколько VIP, распределенных между узлами, а входящий трафик делится между ними с помощью Round-Robin DNS или внешнего балансировщика

**Уровень хранения данных: Репликация и распределенное хранение файлов**

Обеспечение доступности данных требует решения двух задач: синхронизации файлов контента (код сайта, изображения) и репликации базы данных.

Распределенная файловая система (GlusterFS): Для синхронизации файлов между backend-серверами эффективно использовать распределенные файловые системы, такие как GlusterFS. Она создает общее сетевое хранилище (volume), которое монтируется на каждом веб-сервере. Данные, записанные на одном сервере, автоматически реплицируются на другие. Это гарантирует, что все серверы отдают идентичный контент, и позволяет добавлять новые узлы без простоя .

Репликация базы данных (Master-Master): Для обеспечения отказоустойчивости и масштабируемости чтения данных настраивается репликация Master-Master между серверами баз данных. Каждая нода одновременно является и мастером (принимает запись), и слейвом (получает изменения с другого мастера). При выходе из строя одной ноды вторая продолжает работать, принимая операции как на запись, так и на чтение

**Резервное копирование и его отличие от репликации**

Репликация и резервное копирование - взаимодополняющие, но принципиально разные технологии в стратегии защиты данных.

Резервное копирование (Backup) - это создание отдельной, часто сжатой и зашифрованной, копии данных на определенный момент времени для их долгосрочного хранения и восстановления в случае потери или порчи оригинала . Его ключевые характеристики:

- Цель: Восстановление данных после логических ошибок, случайного удаления, атак вредоносного ПО (шифровальщиков) или для соответствия регуляторным требованиям.
- Принцип работы: Создание периодических "снимков" (снапшотов) данных. Восстановление может занимать значительное время.
- Показатель: Recovery Point Objective (RPO) - допустимый объем потерь данных (насколько старыми могут быть данные в резервной копии).

Репликация - это процесс непрерывного или периодического копирования и синхронизации данных между активными системами в реальном времени или около того. Ее ключевые характеристики:

- Цель: Обеспечение высокой доступности (High Availability) и непрерывности бизнеса, минимизация времени простоя.
- Принцип работы: Поддержание одной или нескольких "живых" копий данных. Переключение (failover) на реплику происходит быстро.
- Показатель: Recovery Time Objective (RTO) - допустимое время простоя системы.
- Важное замечание: Репликация не защищает от логических ошибок. Если данные были ошибочно удалены или зашифрованы вирусом на мастере, эта операция немедленно реплицируется на все копии, делая их также неработоспособными. Для защиты от таких сценариев необходимо наличие резервных копий.

Для реплицируемых баз данных резервное копирование требует особого внимания. Необходимо регулярно создавать резервные копии не только самих баз данных (публикации, подписки), но и связанных системных баз (master, msdb), согласованные по времени, чтобы сохранить информацию о конфигурации репликации

**Сценарии использования и практическая реализация**

**Сценарии использования отказоустойчивой архитектуры**

- Корпоративные порталы и интернет-магазины: Системы, где простои напрямую ведут к потере прибыли и клиентов.
- Критически важные веб-сервисы и API: Инфраструктура, которая должна быть доступна 24/7 для мобильных приложений и партнерских интеграций.
- Геораспределенные проекты: когда необходимо обеспечить низкую задержку и отказоустойчивость для пользователей из разных регионов (может потребовать размещения узлов кластера в разных дата-центрах)

**Практические шаги настройки ключевых компонентов**

- **Настройка кластера Keepalived для Nginx** (активно-пассивный режим):
- Установить Nginx и Keepalived на два сервера.
- Настроить маршрутизацию (net.ipv4.ip_forward = 1) и разрешить привязку к нелокальным IP-адресам (net.ipv4.ip_nonlocal_bind = 1) в /etc/sysctl.conf на обоих узлах .
- Отредактировать конфигурационный файл /etc/keepalived/keepalived.conf.
- На активном узле (MASTER) задать более высокий priority (например, 100).
- На резервном узле (BACKUP) задать более низкий priority (например, 50) и указать state BACKUP.
- Запустить и включить службы: systemctl start keepalived && systemctl enable keepalived.
- **Конфигурация Nginx в качестве балансировщика**:
- В конфигурации сайта на каждом балансировщике определить upstream-блок с адресами backend-серверов.
- В блоке server настроить proxy_pass на созданный upstream.
- **Организация репликации базы данных (Master-Master)**:
- На каждом сервере БД (Node1 и Node2) настроить уникальный server-id и включить бинарное логирование в my.cnf.
- На Node1 создать пользователя для репликации и выполнить SHOW MASTER STATUS для получения позиции в логе (File, Position).
- На Node2 выполнить CHANGE MASTER TO, указав данные Node1, и запустить репликацию (START SLAVE).
- Повторить процедуру в обратном порядке, настраивая Node1 как слейв для Node2. После настройки обеих сторон репликация станет двунаправленной (Master-Master).

# Заключение

В рамках данной работы была исследована и описана комплексная архитектура отказоустойчивого веб-кластера. Показано, что достижение высокой доступности - это многоуровневая задача, требующая интеграции различных технологий.

На уровне балансировки нагрузки кластеризация Nginx с помощью Keepalived обеспечивает устранение единой точки отказа и автоматическое восстановление работы при сбоях на одном из узлов. Для backend-серверов критически важна синхронизация состояния, что решается использованием распределенной файловой системы GlusterFS для контента и репликации Master-Master для базы данных. Отдельно подчеркнута ключевая роль стратегии резервного копирования как механизма защиты от логических сбоев и кибератак, который не может быть заменен репликацией.

Реализация подобной инфраструктуры требует тщательного планирования, настройки и последующего тестирования процедур аварийного восстановления. Однако для современных бизнес-приложений, где на кону стоят репутация и доходы, такие инвестиции в отказоустойчивость и защиту данных являются необходимым и оправданным условием надежной работы.

# Список литературы

- Официальная документация NGINX: High Availability с Keepalived \[Электронный ресурс\]. URL: <https://docs.nginx.com/nginx/admin-guide/high-availability/ha-keepalived-nodes/> (дата обращения: 29.12.2025).
- ITTraveler: Настройка отказоустойчивого веб сервера на базе nginx и apache \[Электронный ресурс\]. URL: <https://ittraveler.org/nastrojka-otkazoustojchivogo-veb-servera-na-baze-nginx-i-apache/> (дата обращения: 29.12.2025).
- [Cloud.ru](https://cloud.ru/): Чем отличается резервное копирование от репликации? \[Электронный ресурс\]. URL: <https://cloud.ru/docs/backup-cloud/ug/topics/faq__general__differences-replication> (дата обращения: 29.12.2025).
- ITC-Life: Отказоустойчивый веб-сервер на Linux c помощью NGINX \[Электронный ресурс\]. URL: <https://itc-life.ru/otkazoustojchivyj-veb-server-linux/> (дата обращения: 29.12.2025).
